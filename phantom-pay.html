<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Envoyer 0.1 SOL avec Memo via Phantom</title>
  <script src="https://unpkg.com/@solana/web3.js@1.42.0/lib/index.iife.min.js"></script>
  <style>
    body { font-family: monospace; background: #000; color: #fff; text-align: center; padding: 2rem; }
    button { background: crimson; color: white; border: none; padding: 1rem 2rem; font-size: 1.2rem; border-radius: 8px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>üè¥‚Äç‚ò†Ô∏è Participer √† la loterie</h1>
  <button id="sendTxBtn">Envoyer 0.1 SOL</button>
  <p id="status"></p>

  <script>
    const sendTxBtn = document.getElementById('sendTxBtn');
    const status = document.getElementById('status');

    // R√©cup√©rer tgid dans l'URL
    const params = new URLSearchParams(window.location.search);
    const tgid = params.get('tgid') || 'inconnu';

    async function sendTransaction() {
      if (!window.solana || !window.solana.isPhantom) {
        alert("Phantom Wallet non d√©tect√© !");
        return;
      }

      try {
        await window.solana.connect();

        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'), 'confirmed');
        const fromPubkey = window.solana.publicKey;
        const toPubkey = new solanaWeb3.PublicKey("AISSEwWcUFx1HfmFi5R6uhQpmoCKyZmibqPG1P3r81Ki");

        const transaction = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey,
            toPubkey,
            lamports: 0.1 * solanaWeb3.LAMPORTS_PER_SOL
          })
        );

        // Ajouter instruction Memo
        const memoInstruction = new solanaWeb3.TransactionInstruction({
          keys: [],
          programId: new solanaWeb3.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),
          data: new TextEncoder().encode("rouge_" + tgid),
        });
        transaction.add(memoInstruction);

        transaction.feePayer = fromPubkey;
        transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

        const signed = await window.solana.signTransaction(transaction);
        const signature = await connection.sendRawTransaction(signed.serialize());
        await connection.confirmTransaction(signature, 'confirmed');

        status.textContent = "‚úÖ Transaction envoy√©e : " + signature;
      } catch (err) {
        console.error(err);
        status.textContent = "‚ùå Erreur : " + err.message;
      }
    }

    sendTxBtn.onclick = sendTransaction;
  </script>
</body>
</html>
